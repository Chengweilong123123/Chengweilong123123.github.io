<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="来去都是自由风">
<meta property="og:type" content="website">
<meta property="og:title" content="石圪节公社球头制造者">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="石圪节公社球头制造者">
<meta property="og:description" content="来去都是自由风">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Dragon，王嘉浩">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>石圪节公社球头制造者</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">石圪节公社球头制造者</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/10/%E7%AC%AC%E4%B8%80%E7%AB%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Dragon，王嘉浩">
      <meta itemprop="description" content="来去都是自由风">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="石圪节公社球头制造者">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/10/%E7%AC%AC%E4%B8%80%E7%AB%A0/" class="post-title-link" itemprop="url">第一章</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-10 03:15:27" itemprop="dateCreated datePublished" datetime="2023-09-10T03:15:27+08:00">2023-09-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-09-17 14:09:41" itemprop="dateModified" datetime="2023-09-17T14:09:41+08:00">2023-09-17</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="使用stream流形式递归"><a href="#使用stream流形式递归" class="headerlink" title="使用stream流形式递归"></a>使用stream流形式递归</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/getUser&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> HttpResponses&lt;List&lt;User&gt;&gt; <span class="title function_">getUser</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="type">long</span> startTime=System.currentTimeMillis(); <span class="comment">//获取开始时间</span></span><br><span class="line">        List&lt;User&gt; list = <span class="built_in">this</span>.userService.query().eq(User::getStatus,StatusEnum.NORMAL)</span><br><span class="line">                                                .eq(User::getDirty,StatusEnum.NORMAL).list();</span><br><span class="line">        <span class="comment">//用map写法</span></span><br><span class="line">        <span class="comment">/*List&lt;User&gt; listUser = list.stream().filter(user -&gt; user.getLevelId().equals(&quot;0&quot;)).map(user -&gt; &#123;</span></span><br><span class="line"><span class="comment">            user.setChildList(getChildrens(user,list));</span></span><br><span class="line"><span class="comment">            return user;</span></span><br><span class="line"><span class="comment">        &#125;).collect(Collectors.toList());*/</span></span><br><span class="line">        <span class="comment">//用peek写法</span></span><br><span class="line">        List&lt;User&gt; listUser = list.stream().filter(user -&gt; user.getLevelId().equals(<span class="string">&quot;0&quot;</span>))</span><br><span class="line">                .peek(user -&gt; user.setChildList(getChildrens(user,list))).collect(Collectors.toList());</span><br><span class="line">        <span class="type">long</span> endTime=System.currentTimeMillis(); <span class="comment">//获取结束时间</span></span><br><span class="line">        System.out.println(<span class="string">&quot;程序运行时间： &quot;</span>+(endTime-startTime)+<span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> success(listUser);</span><br><span class="line">    &#125;</span><br><span class="line">获取子类数据</span><br><span class="line"><span class="keyword">public</span> List&lt;User&gt; <span class="title function_">getChildrens</span><span class="params">(User user,List&lt;User&gt; userList)</span>&#123;</span><br><span class="line">        List&lt;User&gt; childrens = userList.stream().filter(u -&gt; Objects.equals(u.getLevelId(),user.getId())).map(</span><br><span class="line">                u -&gt; &#123;</span><br><span class="line">                   u.setChildList(getChildrens(u,userList));</span><br><span class="line">                   <span class="keyword">return</span> u;</span><br><span class="line">                &#125;</span><br><span class="line">        ).collect(Collectors.toList());</span><br><span class="line">        <span class="keyword">return</span> childrens;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="前端nginx部署"><a href="#前端nginx部署" class="headerlink" title="前端nginx部署"></a>前端nginx部署</h3><p>前端部署确认服务器是否有nginx 如果没有，安装一个，建立离线下载，因为生产服务器都是无网或者内网，所以只能离线下载，具体下载可以参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_36754290/article/details/126541006">https://blog.csdn.net/weixin_36754290/article/details/126541006</a></p>
<p>将前端包通过跳板机上传到指定目录，建议放在home目录下的项目名包下</p>
<p><img src="https://docimg7.docs.qq.com/image/AgAAEX-go5gbk0Mo1QpEJazXTrhtsE_w.png?w=383&h=94" alt="img"></p>
<p>这里我就放在这个包下</p>
<p>前端包如果是压缩包的形式需要先进行解压 tar 包解压命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf 文件名</span><br></pre></td></tr></table></figure>

<p>zip 解压命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip 文件名</span><br></pre></td></tr></table></figure>

<p>进入nginx目录 一般放在usr&#x2F;local目录下</p>
<p>进入conf 目录下</p>
<p>这里时配置前端的地方</p>
<p>可以再nginx.conf编辑  也可以新建一个.conf文档</p>
<p>这里我选择新建一个，方便后期快速定位</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi xxx.conf</span><br></pre></td></tr></table></figure>

<p>把这个配置文件复制进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line"></span><br><span class="line">         listen       80;</span><br><span class="line">         server_name  localhost;</span><br><span class="line">         root   /home/xxx/dist;//前端包的绝对路径</span><br><span class="line">         index  index.html index.htm;  </span><br><span class="line">         #处理vue-router路径Start</span><br><span class="line">         #如果找不到路径则跳转到@router变量中寻找,找到了就默认进入index.html</span><br><span class="line">         location / &#123; </span><br><span class="line">             try_files $uri $uri/ /index.html last;</span><br><span class="line">             index  index.html index.htm;</span><br><span class="line">         &#125;</span><br><span class="line">		 #处理访问时不能访问到接口的问题</span><br><span class="line">		 location /sdb_platform&#123;  // 配置接口地址</span><br><span class="line">			#后端接口地址</span><br><span class="line">	    proxy_pass http://后端服务器id:端口;</span><br><span class="line">            add_header Content-Type &quot;text/plain;charset=utf-8&quot;;</span><br><span class="line">            add_header &#x27;Access-Control-Allow-Origin&#x27; &#x27;*&#x27;;</span><br><span class="line">            add_header &#x27;Access-Control-Allow-Credentials&#x27; &#x27;true&#x27;;</span><br><span class="line">            add_header &#x27;Access-Control-Allow-Methods&#x27; &#x27;GET, POST&#x27;;</span><br><span class="line">        &#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>确保内容无丢失，然后保存退出</p>
<p>重启nginx</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd  /usr/local/nginx/sbin</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./nginx -s reload  //如果出现无法启动说明你没有启动nginx 你需要启动一下 每次改完nginx的conf文件都需要重新启动   启动命令 ./nginx</span><br></pre></td></tr></table></figure>

<p>然后去输入你配置的地址看是否可以访问</p>
<h3 id="nginx实现防盗链"><a href="#nginx实现防盗链" class="headerlink" title="nginx实现防盗链"></a>nginx实现防盗链</h3><p><strong>使用Nginx服务器的Rewrite功能实现防盗链。</strong></p>
<p>Nginx中有一个指令 valid_referers. 该指令可以用来获取 Referer 头域中的值，并且根据该值的情况给 Nginx全局变量 invalidreferer赋值。如果Referer头域中没有符合validreferers指令的值的话，invalidreferer赋值。如果Referer头域中没有符合validreferers指令的值的话，invalid_referer变量将会赋值为</p>
<p>valid_referers 指令基本语法如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">valid_referers none | blocked | server_names | string</span><br></pre></td></tr></table></figure>

<p>none: 检测Referer头域不存在的情况。</p>
<p>blocked： 检测Referer头域的值被防火墙或者代理服务器删除或伪装的情况。那么在这种情况下，该头域的值不以”http:&#x2F;&#x2F;“ 或 “https:&#x2F;&#x2F;” 开头。</p>
<p>server_names: 设置一个或多个URL，检测Referer头域的值是否是URL中的某个。</p>
<p>因此我们有了 valid_referers指令和$invalid_referer变量的话，我们就可以通过 Rewrite功能来实现防盗链。</p>
<p>下面我们介绍两种方案：第一：根据请求资源的类型。第二：根据请求目录</p>
<h5 id="1-根据请求文件类型实现防盗链配置实列如下："><a href="#1-根据请求文件类型实现防盗链配置实列如下：" class="headerlink" title="1. 根据请求文件类型实现防盗链配置实列如下："></a><strong>1. 根据请求文件类型实现防盗链配置实列如下：</strong></h5><p>配置如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 8080;</span><br><span class="line">  server_name xxx.abc.com</span><br><span class="line">  location ~* ^.+\.(gif|jpg|png|swf|flv|rar|zip)$ &#123;</span><br><span class="line">    valid_referers none blocked www.xxx.com www.yyy.com *.baidu.com  *.tabobao.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">      rewrite ^/ http://www.xxx.com/images/forbidden.png;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="2-根据请求目录实现防盗链的配置实列如下："><a href="#2-根据请求目录实现防盗链的配置实列如下：" class="headerlink" title="2.     根据请求目录实现防盗链的配置实列如下："></a>2.     根据请求目录实现防盗链的配置实列如下：</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">  listen 8080;</span><br><span class="line">  server_name xxx.abc.com</span><br><span class="line">  location /file/ &#123;</span><br><span class="line">    root /server/file/;</span><br><span class="line">    valid_referers none blocked www.xxx.com www.yyy.com *.baidu.com  *.tabobao.com;</span><br><span class="line">    if ($invalid_referer) &#123;</span><br><span class="line">      rewrite ^/ http://www.xxx.com/images/forbidden.png;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="离线安装docker"><a href="#离线安装docker" class="headerlink" title="离线安装docker"></a>离线安装docker</h3><p>首先，linux安装docker的环境，需要centos的版本最好达到7及以上</p>
<p>首先通过命令查看操作系统版本</p>
<p>在 CentOS 7安装docker要求系统为64位、系统内核版本为 3.10 以上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<p>一般情况下，我是使用离线安装模式，因为到时实际生产环境中，使用的网络可能是局域网，并不能直接访问互联网链接，下载 docker-18.03.1-ce.tgz 版本</p>
<p>下载地址：<a target="_blank" rel="noopener" href="https://download.docker.com/linux/static/stable/x86_64/">https://download.docker.com/linux/static/stable/x86_64/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">解压命令（这里可以下载你实际使用到的版本）</span><br><span class="line">上传到geelyapp目录下/geelyapp</span><br><span class="line">tar -zxvf docker-18.03.1-ce.tgz</span><br><span class="line">解压之后的文件复制到 /usr/bin/ 目录下</span><br><span class="line">cp docker/* /usr/bin/</span><br></pre></td></tr></table></figure>

<h4 id="在-etc-systemd-system-目录下新增docker-service文件"><a href="#在-etc-systemd-system-目录下新增docker-service文件" class="headerlink" title="在&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;目录下新增docker.service文件"></a><strong>在&#x2F;etc&#x2F;systemd&#x2F;system&#x2F;目录下新增docker.service文件</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim  /etc/systemd/system/docker.service</span><br></pre></td></tr></table></figure>

<p>注意：其中的ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd –selinux-enabled&#x3D;false –insecure-registry&#x3D;127.0.0.1 。有的可能会要求粘贴上面的代码，–insecure-registry&#x3D;127.0.0.1表示的是加入允许不安全链接，需要去掉</p>
<p>(注意此处启动之后没有问题)复制完之后，检查一下是否完整</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">  </span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line"># the default is not to use systemd for cgroups because the delegate issues still</span><br><span class="line"># exists and systemd currently does not support the cgroup feature set required</span><br><span class="line"># for containers run by docker</span><br><span class="line">ExecStart=/usr/bin/dockerd --selinux-enabled=false</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line"># Having non-zero Limit*s causes performance problems due to accounting overhead</span><br><span class="line"># in the kernel. We recommend using cgroups to do container-local accounting.</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line"># Uncomment TasksMax if your systemd version supports it.</span><br><span class="line"># Only systemd 226 and above support this version.</span><br><span class="line">#TasksMax=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line"># set delegate yes so that systemd does not reset the cgroups of docker containers</span><br><span class="line">Delegate=yes</span><br><span class="line"># kill only the docker process, not all processes in the cgroup</span><br><span class="line">KillMode=process</span><br><span class="line"># restart the docker process if it exits prematurely</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line">  </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="启动docker"><a href="#启动docker" class="headerlink" title="启动docker"></a><strong>启动docker</strong></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">#给docker.service文件添加执行权限</span><br><span class="line">chmod +x /etc/systemd/system/docker.service</span><br><span class="line"></span><br><span class="line">#重新加载配置文件（每次有修改docker.service文件时都要重新加载下）</span><br><span class="line">systemctl daemon-reload   </span><br><span class="line"></span><br><span class="line">#启动docker</span><br><span class="line">systemctl start docker</span><br><span class="line"></span><br><span class="line"># 设置开机启动</span><br><span class="line">systemctl enable docker.service</span><br><span class="line"></span><br><span class="line">#查看docker服务状态</span><br><span class="line">systemctl status docker</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="influxdb时区异常解决"><a href="#influxdb时区异常解决" class="headerlink" title="influxdb时区异常解决"></a><strong>influxdb时区异常解决</strong></h3><p>我们使用influxdb时候，可能会遇到一些特殊报错，比如时期报错如下图</p>
<p><img src="https://docimg10.docs.qq.com/image/AgAAEX-go5hIdM_2dRBEWoYwifVu5-DG.png?w=1894&h=242" alt="img"></p>
<p>对于这种报错，是因为安装influxdb服务器上对于时区的规则没有定义，我们只需要下载一个插件就可完美解决</p>
<p>tzdata</p>
<p>命令如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tzdata</span><br></pre></td></tr></table></figure>

<p>下载以后输入y</p>
<p>就可解决时区报错</p>
<p>记得要重启项目，重新加载influxdb的配置</p>
<h3 id="彩云天气接入实时天气"><a href="#彩云天气接入实时天气" class="headerlink" title="彩云天气接入实时天气"></a>彩云天气接入实时天气</h3><p>需要去官网申请token和付费限制</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.caiyunapp.com/v2.6/token/经纬度/daily?dailysteps=3</span><br></pre></td></tr></table></figure>

<p>然后调用解析返回的json文件</p>
<h3 id="websocket搭建"><a href="#websocket搭建" class="headerlink" title="websocket搭建"></a>websocket搭建</h3><p>引入pom</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"> &lt;dependencies&gt;</span><br><span class="line">        &lt;!-- WebSocket --&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">            &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">    &lt;/dependencies&gt;</span><br><span class="line"></span><br><span class="line">    &lt;build&gt;</span><br><span class="line">&lt;!--        &lt;plugins&gt;--&gt;</span><br><span class="line">&lt;!--            &lt;plugin&gt;--&gt;</span><br><span class="line">&lt;!--                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;--&gt;</span><br><span class="line">&lt;!--                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;--&gt;</span><br><span class="line">&lt;!--            &lt;/plugin&gt;--&gt;</span><br><span class="line">&lt;!--        &lt;/plugins&gt;--&gt;</span><br><span class="line">        &lt;plugins&gt;</span><br><span class="line">            &lt;plugin&gt;</span><br><span class="line">                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">                &lt;version&gt;2.4.1&lt;/version&gt;</span><br><span class="line">                &lt;configuration&gt;</span><br><span class="line">                    &lt;mainClass&gt;com.star.qiaosi.StartQiaosiWebsocketApplication&lt;/mainClass&gt;</span><br><span class="line">                &lt;/configuration&gt;</span><br><span class="line">                &lt;executions&gt;</span><br><span class="line">                    &lt;execution&gt;</span><br><span class="line">                        &lt;id&gt;repackage&lt;/id&gt;</span><br><span class="line">                        &lt;goals&gt;</span><br><span class="line">                            &lt;goal&gt;repackage&lt;/goal&gt;</span><br><span class="line">                        &lt;/goals&gt;</span><br><span class="line">                    &lt;/execution&gt;</span><br><span class="line">                &lt;/executions&gt;</span><br><span class="line">            &lt;/plugin&gt;</span><br><span class="line">        &lt;/plugins&gt;</span><br><span class="line">    &lt;/build&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>编写配置类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebSocketConfig</span> <span class="keyword">implements</span> <span class="title class_">WebSocketMessageBrokerConfigurer</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServerEndpointExporter <span class="title function_">serverEndpointExporter</span><span class="params">()</span>&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ServerEndpointExporter</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServletServerContainerFactoryBean <span class="title function_">createWebSocketContainer</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">ServletServerContainerFactoryBean</span> <span class="variable">container</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ServletServerContainerFactoryBean</span>();</span><br><span class="line">        <span class="comment">// 在此处设置bufferSize</span></span><br><span class="line">        <span class="type">Integer</span> <span class="variable">size</span> <span class="operator">=</span> <span class="number">512</span> * <span class="number">1024</span> ;</span><br><span class="line">        container.setMaxTextMessageBufferSize(size);</span><br><span class="line">        container.setMaxBinaryMessageBufferSize(size);</span><br><span class="line">        container.setMaxSessionIdleTimeout(<span class="number">15</span> * <span class="number">60000L</span>);</span><br><span class="line">        <span class="keyword">return</span> container;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编写服务类  这个我加了websocket的心跳机制 如果业务上不要可以不加 需要前端配合定时发送心跳信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line">package com.star.qiaosi.server;</span><br><span class="line"></span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.socket.config.annotation.WebSocketMessageBrokerConfigurer;</span><br><span class="line"></span><br><span class="line">import javax.websocket.*;</span><br><span class="line">import javax.websocket.server.ServerEndpoint;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line">import java.util.concurrent.CopyOnWriteArraySet;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author Weilong.Cheng</span><br><span class="line"> * @description: webSocket 服务端</span><br><span class="line"> * @date 2023/5/11 16:00</span><br><span class="line"> */</span><br><span class="line">@Component</span><br><span class="line">@ServerEndpoint(&quot;/star-qiaosi/websocket&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">public class WebSocketServer implements WebSocketMessageBrokerConfigurer &#123;</span><br><span class="line"></span><br><span class="line">    private Session session;</span><br><span class="line">    private  static  final  String HEART_REQUEST=&quot;ping&quot;;</span><br><span class="line">    private  static  final  String HEART_RESPONSE=&quot;pong&quot;;</span><br><span class="line"></span><br><span class="line">    /*  存放websocket的集合  */</span><br><span class="line">    private static CopyOnWriteArraySet&lt;WebSocketServer&gt; webSocketSet = new CopyOnWriteArraySet&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    /* 存放session */</span><br><span class="line">    //public static ConcurrentHashMap&lt;String, Session&gt; sessionMap = new ConcurrentHashMap&lt;String, Session&gt;();</span><br><span class="line"></span><br><span class="line">    public static CopyOnWriteArrayList&lt;Session&gt; sessionList = new CopyOnWriteArrayList();</span><br><span class="line"></span><br><span class="line">    /*</span><br><span class="line">     *默认情况下，Spring Boot 对 WebSockets 不设置数据上限。</span><br><span class="line">     * WebSockets 的数据上限通常取决于服务器和客户端的配置以及网络带宽</span><br><span class="line">     * websocket设置数据上线实例  50MB</span><br><span class="line">     * 需要本类实现websocket的配置类   implements WebSocketMessageBrokerConfigurer</span><br><span class="line">     * */</span><br><span class="line">//    @Override</span><br><span class="line">//    public void configureWebSocketTransport(WebSocketTransportRegistration registration) &#123;</span><br><span class="line">//        registration.setMessageSizeLimit(5 * 1024 * 1024);</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line">    @OnOpen</span><br><span class="line">    public void onOpen(Session session) &#123;</span><br><span class="line">        this.session = session;</span><br><span class="line">        sessionList.add(session);</span><br><span class="line">        log.info(&quot;websocket连接成功!用户:&#123;&#125;,当前共 &#123;&#125; 位用户在线&quot;, session.getId(), sessionList.size());</span><br><span class="line">//        if (!StringUtils.isBlank(userId)) &#123;</span><br><span class="line">//            sessionMap.put(userId, session);</span><br><span class="line">//            webSocketSet.add(this);</span><br><span class="line">//            log.info(&quot;websocket连接成功!用户id:&#123;&#125;&quot;, userId);</span><br><span class="line">//        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnClose</span><br><span class="line">    public void onClose() &#123;</span><br><span class="line">        //log.info(&quot;&#123;&#125;web&quot;, this.session.getBasicRemote());</span><br><span class="line">        webSocketSet.remove(this);  //从set中删除</span><br><span class="line">        sessionList.remove(this.session);  //从List中删除</span><br><span class="line">        log.info(&quot;用户:&#123;&#125; 登出,当前共 &#123;&#125; 位用户在线&quot;, this.session.getId(), sessionList.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @OnMessage</span><br><span class="line">    public void onWebSocketText(String message) &#123;</span><br><span class="line">        if (HEART_REQUEST.equals(message)) &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                session.getBasicRemote().sendText(HEART_RESPONSE);</span><br><span class="line">                log.info(&quot;Sent heartbeat response&quot;);</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            for (Session session : sessionList) &#123;</span><br><span class="line">                sendMessage(session, message);</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(&quot;Sent heartbeat response.&quot; + message);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * @param session</span><br><span class="line">     * @param error</span><br><span class="line">     */</span><br><span class="line">    @OnError</span><br><span class="line">    public void onError(Session session, Throwable error) &#123;</span><br><span class="line">        log.error(&quot;发生错误:&#123;&#125;&quot;, error.getMessage());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">//    public void sendMessage(String uuid, String message) &#123;</span><br><span class="line">//        log.info(&quot;指定客户端发消息:&#123;&#125; MSG:&quot;, uuid, message);</span><br><span class="line">//        Session session = sessionMap.get(uuid);</span><br><span class="line">//        if (session != null) &#123;</span><br><span class="line">//            try &#123;</span><br><span class="line">//                session.getBasicRemote().sendText(message);</span><br><span class="line">//            &#125; catch (IOException e) &#123;</span><br><span class="line">//                e.printStackTrace();</span><br><span class="line">//            &#125;</span><br><span class="line">//        &#125;</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line">    public synchronized void sendMessage(Session session, String msg) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            session.getBasicRemote().sendText(msg);</span><br><span class="line">            //session.getAsyncRemote().sendText(msg);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="stream-流使用"><a href="#stream-流使用" class="headerlink" title="stream 流使用"></a>stream 流使用</h3><h4 id="map方法"><a href="#map方法" class="headerlink" title="map方法"></a><strong>map方法</strong></h4><p>map方法用于根据自定义的规则对stream流中的数据做一对一的映射</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//获取所有员工的姓名</span><br><span class="line">List&lt;String&gt; enames = employees.stream().map(employee -&gt; employee.getEname()).collect(Collectors.toList());</span><br><span class="line">enames.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h4 id="mapToInt-mapToLong-mapToDouble方法"><a href="#mapToInt-mapToLong-mapToDouble方法" class="headerlink" title="mapToInt&#x2F;mapToLong&#x2F;mapToDouble方法"></a><strong>mapToInt&#x2F;mapToLong&#x2F;mapToDouble方法</strong></h4><p>这几个方法主要用来对stream流中的元素产生单个的统计结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> //获取所有员工的薪水总和</span><br><span class="line">int totalSalary = employees.stream().mapToInt(employee -&gt; employee.getSalary()).sum();</span><br><span class="line">System.out.println(&quot;薪水总和：&quot; + totalSalary);</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">薪水总和：7200</span><br></pre></td></tr></table></figure>

<h4 id="filter方法"><a href="#filter方法" class="headerlink" title="filter方法"></a><strong>filter方法</strong></h4><p>filter方法用于根据设置的条件对stream流中的数据做过滤操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//获取薪水超过1500的员工</span><br><span class="line">List&lt;Employee&gt; filterEmp = employees.stream().filter(employee -&gt; employee.getSalary()&gt;1500).collect(Collectors.toList());</span><br><span class="line">filterEmp.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p>执行结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Employee&#123;empno=7499, ename=&#x27;ALLEN&#x27;, salary=1600, deptno=30&#125;</span><br><span class="line">Employee&#123;empno=7782, ename=&#x27;CLARK&#x27;, salary=2450, deptno=10&#125;</span><br></pre></td></tr></table></figure>

<h4 id="sorted方法"><a href="#sorted方法" class="headerlink" title="sorted方法"></a><strong>sorted方法</strong></h4><p>sorted方法用于对流中的元素进行排序</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//按员工的薪水由低到高排序</span><br><span class="line">List&lt;Employee&gt; sortedEmp = employees.stream().sorted(Comparator.comparing(Employee::getSalary)).collect(Collectors.toList());</span><br><span class="line">sortedEmp.stream().forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<p>执行结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Employee&#123;empno=7369, ename=&#x27;SMITH&#x27;, salary=800, deptno=20&#125;</span><br><span class="line">Employee&#123;empno=7876, ename=&#x27;ADAMS&#x27;, salary=1100, deptno=20&#125;</span><br><span class="line">Employee&#123;empno=7521, ename=&#x27;WARD&#x27;, salary=1250, deptno=30&#125;</span><br><span class="line">Employee&#123;empno=7499, ename=&#x27;ALLEN&#x27;, salary=1600, deptno=30&#125;</span><br><span class="line">Employee&#123;empno=7782, ename=&#x27;CLARK&#x27;, salary=2450, deptno=10&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Collectors类</strong></p>
<p>Collectors 类实现了很多归约操作，例如将流转换成集合和聚合元素。Collectors 可用于返回列表或字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//按员工所属部门号进行分类</span><br><span class="line">Map&lt;Integer, List&lt;Employee&gt;&gt; map = employees.stream().collect(Collectors.groupingBy(employee -&gt; employee.getDeptno()));</span><br><span class="line">for(Map.Entry&lt;Integer, List&lt;Employee&gt;&gt; entry : map.entrySet()) &#123;</span><br><span class="line">    System.out.println(&quot;key: &quot; + entry.getKey() + &quot;  value：&quot; + entry.getValue());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">System.out.println();</span><br><span class="line"></span><br><span class="line">//获取员工姓名，用&quot;,&quot;进行拼接</span><br><span class="line">String enameString = employees.stream().map(employee -&gt; employee.getEname()).collect(Collectors.joining(&quot;,&quot;));</span><br><span class="line">System.out.println(enameString);</span><br></pre></td></tr></table></figure>

<h3 id="Mysql的坑"><a href="#Mysql的坑" class="headerlink" title="Mysql的坑"></a>Mysql的坑</h3><p> 在MySQL 5.6及以后的版本上，优化器在遇到order by limit语句的时候，做了一个优化，即使用了priority queue。使用 priority queue 的目的，是在不能使用索引有序性的时候，如果要排序，并且使用了limitn，那么只需要在排序的过程中，保留n条记录即可，这样虽然不能解决所有记录都需要排序的开销，但是只需要 sort buffer少量的内存就可以完成排序。</p>
<p>   之所以5.6出现了第二页数据重复的问题，是因为 priority queue使用了堆排序的排序方法，而堆排序是一个不稳定的排序方法，也就是相同的值可能排序出来的结果和读出来的数据顺序不一致。5.5 没有这个优化，所以也就不会出现这个问题。</p>
<p>   快速排序和堆排序是不稳定的排序算法，也就是对于重复值是不能保证顺序的。而直接利用索引的话其返回数据是稳定的，因为索引的B+树叶子结点的顺序是唯一且一定的，快速排序适合大数据量排序，堆排序在少量排序上有优势。</p>
<p>解决方式两种 </p>
<h5 id="1-，如果你们公司业务允许这样的情况，因为数据是在的，只不过是展示的时候多了一条，那就不处理"><a href="#1-，如果你们公司业务允许这样的情况，因为数据是在的，只不过是展示的时候多了一条，那就不处理" class="headerlink" title="1 ，如果你们公司业务允许这样的情况，因为数据是在的，只不过是展示的时候多了一条，那就不处理"></a>1 ，如果你们公司业务允许这样的情况，因为数据是在的，只不过是展示的时候多了一条，那就不处理</h5><h5 id="2，可以通过联合条件，比如通过时间和id去升序降序查"><a href="#2，可以通过联合条件，比如通过时间和id去升序降序查" class="headerlink" title="2，可以通过联合条件，比如通过时间和id去升序降序查"></a>2，可以通过联合条件，比如通过时间和id去升序降序查</h5><h3 id="Mysql可以通过过滤字段查数据"><a href="#Mysql可以通过过滤字段查数据" class="headerlink" title="Mysql可以通过过滤字段查数据"></a>Mysql可以通过过滤字段查数据</h3><p>首先有个这样的需求，根据解决人id去查数据，另外你们公司的数据库是这种扯淡设计</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">事件id   事件名称   解决人id</span><br><span class="line">1        xxx       1,2,3,4</span><br><span class="line">2        xxx       1,3,4</span><br><span class="line">3        xxx       1,2,4</span><br><span class="line">4        xxx       3</span><br></pre></td></tr></table></figure>

<p>这种情况下我要你根据解决人去查数据 比如 前端传过来的是2  这样就需要得出事件id是1，3的数据</p>
<p>我们首先想的是不是就是得出所有数据，通过split（”，”），然后去equals 过滤掉不符合的数据</p>
<p>这种方法也可以做，但是不太优雅，我们需要进行很多if  不符合开发规范</p>
<p>其实mysql有自带的这种情况的函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find_in_set()</span><br></pre></td></tr></table></figure>

<p>这时候我们的mysql语句就可以写成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `表名` where FIND_IN_SET(49,解决人id)</span><br></pre></td></tr></table></figure>

<p>这样就可以解决这种问题</p>
<h3 id="minio服务器搭建"><a href="#minio服务器搭建" class="headerlink" title="minio服务器搭建"></a>minio服务器搭建</h3><h3 id="安全漏洞解决办法"><a href="#安全漏洞解决办法" class="headerlink" title="安全漏洞解决办法"></a>安全漏洞解决办法</h3><p>1,sql 注入<br>通过#{}解决传参<br>2,不安全的http方法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($request_method !~* GET|POST|HEAD) &#123;</span><br><span class="line">return 403;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3,xss<br>不能输入js代码<br>4,csrf</p>
<p>5,垂直越权<br>6,水平越权<br>7,任意文件上传<br>····1.文件大小的合理限制 （通用5M大小限制，具体可根据业务需求设置）<br>····2.白名单检查文件扩展名<br>····3.确保文件名不包含任何可能被解释为目录或遍历序列 ( ..&#x2F;) 的子字符串<br>····4.重命名上传的文件以避免可能导致现有文件被覆盖的冲突<br>····5.隐藏上传文件路径<br>····6.病毒扫描 （影响性能，根据客户需要设置）<br>····7.上传文件的存储目录禁用执行权限<br>····8.在完全验证之前不要将文件上传到服务器的永久文件系统.<br>····9.内容检测要求：<br>        A. 文件类型根据具体业务需求设置白名单<br>             例子：人员头像（限制上传图片格式）、考勤表单（pdf或者图片格式）<br>        B. 文件类型建议不要有txt文件上传，除业务需求例外。<br>        C. 文件上传的内容和文件上传的扩展名一致。      </p>
<p>···········通用白名单文件类型：<br>···········图片类型： jpg、jpeg、bmp、png、gif<br>···········文件类型： pdf、doc、docx、xls、xlsx、xlsm，xlt、xltx、ppt、pptx<br>···········文本类型： txt（特例情况使用，尽量不要设置该白名单）<br>8,弱密码<br>密码复杂度颗粒修改<br>9,<br>10，暴露nginx版本信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">在nginx 的conf目录中 ，编辑 nginx.conf文件</span><br><span class="line"></span><br><span class="line">在http节点中 添加 server_tokens off;</span><br></pre></td></tr></table></figure>

<h3 id="linux开放指定端口"><a href="#linux开放指定端口" class="headerlink" title="linux开放指定端口"></a>linux开放指定端口</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd ``--zone=public --add-port=1935/tcp --permanent</span><br></pre></td></tr></table></figure>

<ul>
<li>–zone #作用域</li>
<li>–add-port&#x3D;1935&#x2F;tcp #添加端口，格式为：端口&#x2F;通讯协议</li>
<li>–permanent #永久生效，没有此参数重启后失效</li>
</ul>
<h3 id="kafka监听消息"><a href="#kafka监听消息" class="headerlink" title="kafka监听消息"></a>kafka监听消息</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@KafkaListener(id = &quot;监听器id&quot;,topicPattern = &quot;正则表达式匹配队列&quot;)</span><br><span class="line">    public void receiveMsg(ConsumerRecord&lt;?,?&gt; consumerRecord)&#123;</span><br><span class="line">        //业务数据为json字符串</span><br><span class="line">        String value = (String) consumerRecord.value();</span><br><span class="line">        //类型转换</span><br><span class="line">        ExceptionEventPO o = JSONObject.parseObject(value, ExceptionEventPO.class);</span><br><span class="line">        //其他业务</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>@KafkaListener(id&#x3D;”<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=%E7%9B%91%E5%90%AC%E5%99%A8&spm=1001.2101.3001.7020">监听器</a>id”,groupId&#x3D;”消费组名”,topicPattern&#x3D;”较适用于正则表达式匹配多个队列”,topics&#x3D;{“队列名1”,”队列名2”})</p>
<p>topicPattern属性 为队列正则表达式用法，与topics属性相斥。</p>
<h3 id="docker部署离线镜像包"><a href="#docker部署离线镜像包" class="headerlink" title="docker部署离线镜像包"></a>docker部署离线镜像包</h3><h3 id="分布式锁具备的条件"><a href="#分布式锁具备的条件" class="headerlink" title="分布式锁具备的条件"></a>分布式锁具备的条件</h3><p>互斥性：任意时刻，只能有一个客户端持有锁</p>
<p>锁超时释放：持有锁超时，可以释放，防止死锁</p>
<p>可重入性：一个线程获取了锁之后，可以再次对其请求加锁</p>
<p>高可用、高性能：加锁和解锁开销要尽可能低，同时保证高可用</p>
<p>安全性：锁只能被持有该锁的服务(或应用)释放。</p>
<p>容错性：在持有锁的服务崩溃时，锁仍能得到释放，避免死锁。</p>
<h4 id="分布式锁实现方案"><a href="#分布式锁实现方案" class="headerlink" title="分布式锁实现方案"></a>分布式锁实现方案</h4><p>分布式锁都是通过第三方组件来实现的，目前比较流行的分布式锁的解决方案有：</p>
<p>1、数据库，通过数据库可以实现分布式锁，但是在高并发的情况下对数据库压力较大，所以很少使用。<br>2、Redis，借助Redis也可以实现分布式锁，而且Redis的Java客户端种类很多，使用的方法也不尽相同。<br>3、Zookeeper，Zookeeper也可以实现分布式锁，同样Zookeeper也存在多个Java客户端，使用方法也不相同</p>
<p>数据库、zookeeper 参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/poizxc2014/article/details/123963250">https://blog.csdn.net/poizxc2014/article/details/123963250</a></p>
<h4 id="Redis实现分布式锁"><a href="#Redis实现分布式锁" class="headerlink" title="Redis实现分布式锁"></a>Redis实现分布式锁</h4><p>1）基本方案：Redis提供了setXX指令来实现分布式锁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SETNX</span><br><span class="line"></span><br><span class="line">格式: setnx key value</span><br><span class="line">将key 的值设为value ，当且仅当key不存在。</span><br><span class="line">若给定的 key已经存在，则SETNX不做任何动作。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">String REDIS_LOCAK=&quot;xxx&quot;;</span><br><span class="line">String value =UUID.randomUUID().toString().replace(&quot;-&quot;,&quot;&quot;);</span><br><span class="line">template.opsForValue().setIfAbsent(REDIS_LOCK,value)</span><br></pre></td></tr></table></figure>

<p>可以给锁设置一个超时时间，到时自动释放锁（锁的过期时间大于业务执行时间）</p>
<p>不然会产生死锁</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">template.opsForValue().setIfAbsent(REDIS_LOCK,value)</span><br><span class="line">template.expire(REDIS_LOCK,timeout:10,TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<p>分步操作 需要保证原子性</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">template.opsForValue().setIfAbsent(REDIS_LOCK,value，10L,TimeUnit.SECONDS);</span><br></pre></td></tr></table></figure>

<h4 id="2-redission"><a href="#2-redission" class="headerlink" title="2,redission"></a>2,redission</h4><p>引入依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.redission&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;redission&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.6.5&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在在主启动类中加入如下配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Bean</span><br><span class="line">public Redisson redisson()&#123;</span><br><span class="line">//此为单机模式</span><br><span class="line">Config config=new Config();</span><br><span class="line">config.useSingleServer().setAddress(&quot;redis://localhost:6379&quot;).setDatabase(0);</span><br><span class="line">// config.setLockWatchdogTimeout(1000); //设置分布式锁watch dog超时时间</span><br><span class="line">return (Redisson) Redisson.create(config);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Rlock redissonLock=redission.getLock(REDIS_LOCK);</span><br><span class="line">redissonLock.unlock();//解锁</span><br></pre></td></tr></table></figure>

<p><strong>Redis与zookeeper分布式锁对比</strong></p>
<p>redis集群是AP,zookeeper集群是CP,redis在集群架构上性能很高，zookeeper在数据一致性上做的更好。</p>
<p>redis往主节点写成功key，马上告诉客户端写成功，收到半数的返回结果就可以执行代码逻辑。所以redis采用抢占式方式进行锁的获取，需要不断的在用户态进行CAS尝试获取锁，对CPU占用率高。</p>
<p>zookeeper在主节点中写好key，会把key同步给所有从节点，并且接受从节点是否同步成功返回。当主节点接收到半数以上的同步成功的结果,就会返回客户端可以执行业务逻辑了。</p>
<p>Zookeeper不会出现主从架构锁丢失问题，主节点挂了，zookeeper的ZAB选举机制一定会把同步成功的从节点变为主节点。</p>
<p>如果追求正确，就选zk集群，如果允许一点出错，追求性能，那选redis</p>
<p>对于redis分布式锁的使用，在企业中是非常常见的，绝大多数情况不会出现极端情况。</p>
<h3 id="oracle安装"><a href="#oracle安装" class="headerlink" title="oracle安装"></a>oracle安装</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/m0_51613816/article/details/127487647">(5条消息) Oracle完整安装详解_oracle安装_皓慕的博客-CSDN博客</a></p>
<h3 id="Mysql分库分表查询"><a href="#Mysql分库分表查询" class="headerlink" title="Mysql分库分表查询"></a>Mysql分库分表查询</h3><h3 id="OSS个人的密码"><a href="#OSS个人的密码" class="headerlink" title="OSS个人的密码"></a>OSS个人的密码</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">oss:</span><br><span class="line">  host: https://oss-cn-hangzhou.aliyuncs.com</span><br><span class="line">  bucketName: cwl2</span><br><span class="line">  endpoint: oss-cn-hangzhou.aliyuncs.com</span><br><span class="line">  accessKeyId: LTAI5tGhGWxkWahMd6Fqp6Er</span><br><span class="line">  accessKeySecret: kscqLHqum0QBco90Jk22YrVAHATgby</span><br></pre></td></tr></table></figure>

<h3 id="阿里云OSS图片上传"><a href="#阿里云OSS图片上传" class="headerlink" title="阿里云OSS图片上传"></a>阿里云OSS图片上传</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">package com.star.qiaosi.constant;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.InitializingBean;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * OSS配置类</span><br><span class="line"> *</span><br><span class="line"> * @author An</span><br><span class="line"> * @description TODO</span><br><span class="line"> * @date 2022/6/22 1:06</span><br><span class="line"> */</span><br><span class="line">// 当项目启动，Spring 接口，Spring加载之后执行接口中的方法</span><br><span class="line">@Component</span><br><span class="line">public class ConstantPropertiesUtils implements InitializingBean &#123;</span><br><span class="line">    // 读取配置文件内容</span><br><span class="line">    @Value(&quot;$&#123;oss.endpoint&#125;&quot;)</span><br><span class="line">    private String endpoint;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;oss.accessKeyId&#125;&quot;)</span><br><span class="line">    private String keyId;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;oss.accessKeySecret&#125;&quot;)</span><br><span class="line">    private String keySecret;</span><br><span class="line"></span><br><span class="line">    @Value(&quot;$&#123;oss.bucketName&#125;&quot;)</span><br><span class="line">    private String bucketName;</span><br><span class="line"></span><br><span class="line">    // 定义公开的静态常量</span><br><span class="line">    public static String END_POINT;</span><br><span class="line">    public static String ACCESS_KEY_ID;</span><br><span class="line">    public static String ACCESS_KEY_SECRET;</span><br><span class="line">    public static String BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void afterPropertiesSet() throws Exception &#123;</span><br><span class="line">        END_POINT = endpoint;</span><br><span class="line">        ACCESS_KEY_ID = keyId;</span><br><span class="line">        ACCESS_KEY_SECRET = keySecret;</span><br><span class="line">        BUCKET_NAME = bucketName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line">package com.star.qiaosi.utils;</span><br><span class="line"></span><br><span class="line">import com.aliyun.oss.OSS;</span><br><span class="line">import com.aliyun.oss.OSSClientBuilder;</span><br><span class="line">import com.aliyun.oss.model.ObjectMetadata;</span><br><span class="line">import com.star.qiaosi.constant.ConstantPropertiesUtils;</span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import java.io.ByteArrayInputStream;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 文件上传工具类</span><br><span class="line"> */</span><br><span class="line">@Data</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;oss&quot;)</span><br><span class="line">public class OssUtils &#123;</span><br><span class="line"></span><br><span class="line">    private String host;</span><br><span class="line"></span><br><span class="line">    private String bucketName;</span><br><span class="line"></span><br><span class="line">    private String endpoint;</span><br><span class="line"></span><br><span class="line">    private String accessKeyId;</span><br><span class="line"></span><br><span class="line">    private String accessKeySecret;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 上传文件</span><br><span class="line">     * @param file</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object upload(MultipartFile file) &#123;</span><br><span class="line">        // yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span><br><span class="line">        String endpoint = ConstantPropertiesUtils.END_POINT;</span><br><span class="line">        // 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span><br><span class="line">        String accessKeyId = ConstantPropertiesUtils.ACCESS_KEY_ID;</span><br><span class="line">        String accessKeySecret = ConstantPropertiesUtils.ACCESS_KEY_SECRET;</span><br><span class="line">        // 填写Bucket名称，例如examplebucket。</span><br><span class="line">        String bucketName = ConstantPropertiesUtils.BUCKET_NAME;</span><br><span class="line"></span><br><span class="line">        // 创建OSSClient实例。</span><br><span class="line">        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">        // 上传文件流</span><br><span class="line">        try &#123;</span><br><span class="line">            // 获取文件的名称</span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            ObjectMetadata objectMetadata = new ObjectMetadata();</span><br><span class="line">            objectMetadata.setContentType(getcontentType(fileName.substring(fileName.lastIndexOf(&quot;.&quot;))));</span><br><span class="line">            // 调用oss的方法实现长传</span><br><span class="line">            // 第一个参数 bucketName</span><br><span class="line">            // 第二个参数 上传到oss的文件路径和文件名称</span><br><span class="line">            ossClient.putObject(bucketName, fileName, new ByteArrayInputStream(file.getBytes()),objectMetadata);</span><br><span class="line">            // 关闭OSSClient。</span><br><span class="line">            ossClient.shutdown();</span><br><span class="line">            // 把上传的文件路径返回 （手动拼接）</span><br><span class="line">            // 这里设置图片有效时间 我设置了30年</span><br><span class="line">            Date expiration = new Date(System.currentTimeMillis() + 946080000 * 1000);</span><br><span class="line">            String url = ossClient.generatePresignedUrl(bucketName, fileName, expiration).toString();</span><br><span class="line">            return url;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除图片</span><br><span class="line">     * @param fileUrl</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean deleteImages(String fileUrl) &#123;</span><br><span class="line">        // yourEndpoint填写Bucket所在地域对应的Endpoint。以华东1（杭州）为例，Endpoint填写为https://oss-cn-hangzhou.aliyuncs.com。</span><br><span class="line">        String endpoint = ConstantPropertiesUtils.END_POINT;</span><br><span class="line">        // 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span><br><span class="line">        String accessKeyId = ConstantPropertiesUtils.ACCESS_KEY_ID;</span><br><span class="line">        String accessKeySecret = ConstantPropertiesUtils.ACCESS_KEY_SECRET;</span><br><span class="line">        // 填写Bucket名称，例如examplebucket。</span><br><span class="line">        String bucketName = ConstantPropertiesUtils.BUCKET_NAME;</span><br><span class="line">        //创建OSSClient实例</span><br><span class="line">        OSS ossClient = new OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line">        String imgFile = fileUrl.replace(&quot;https://bucket-ans.oss-cn-hangzhou.aliyuncs.com/&quot;, &quot;&quot;);</span><br><span class="line">        String fileName = imgFile.substring(0, imgFile.indexOf(&quot;?&quot;));</span><br><span class="line"></span><br><span class="line">        // 根据BucketName,objectName删除文件</span><br><span class="line">        ossClient.deleteObject(bucketName, fileName);</span><br><span class="line">        ossClient.shutdown();</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 预图片</span><br><span class="line">     * @param FilenameExtension</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static String getcontentType(String FilenameExtension) &#123;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.bmp&quot;)) &#123;</span><br><span class="line">            return &quot;image/bmp&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.gif&quot;)) &#123;</span><br><span class="line">            return &quot;image/gif&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.jpeg&quot;) ||</span><br><span class="line">                FilenameExtension.equalsIgnoreCase(&quot;.jpg&quot;) ||</span><br><span class="line">                FilenameExtension.equalsIgnoreCase(&quot;.png&quot;)) &#123;</span><br><span class="line">            return &quot;image/jpg&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.html&quot;)) &#123;</span><br><span class="line">            return &quot;text/html&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.txt&quot;)) &#123;</span><br><span class="line">            return &quot;text/plain&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.vsd&quot;)) &#123;</span><br><span class="line">            return &quot;application/vnd.visio&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.pptx&quot;) ||</span><br><span class="line">                FilenameExtension.equalsIgnoreCase(&quot;.ppt&quot;)) &#123;</span><br><span class="line">            return &quot;application/vnd.ms-powerpoint&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.docx&quot;) ||</span><br><span class="line">                FilenameExtension.equalsIgnoreCase(&quot;.doc&quot;)) &#123;</span><br><span class="line">            return &quot;application/msword&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        if (FilenameExtension.equalsIgnoreCase(&quot;.xml&quot;)) &#123;</span><br><span class="line">            return &quot;text/xml&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;image/jpg&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="OBS资源服务器上传"><a href="#OBS资源服务器上传" class="headerlink" title="OBS资源服务器上传"></a>OBS资源服务器上传</h3><p>.yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">obs:</span><br><span class="line">  ak:</span><br><span class="line">  sk:</span><br><span class="line">  endPoint:</span><br><span class="line">  bucketName:</span><br></pre></td></tr></table></figure>

<p>pom依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.huaweicloud&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;esdk-obs-java-bundle&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.21.8&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>工具类配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br></pre></td><td class="code"><pre><span class="line">package com.star.qiaosi.utils;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import cn.hutool.core.io.FileUtil;</span><br><span class="line">import com.obs.services.ObsClient;</span><br><span class="line">import com.obs.services.exception.ObsException;</span><br><span class="line">import com.obs.services.model.*;</span><br><span class="line"></span><br><span class="line">import com.star.qiaosi.config.OBSProperties;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line">import org.springframework.util.Assert;</span><br><span class="line">import org.springframework.util.CollectionUtils;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">import java.io.*;</span><br><span class="line">import java.net.URLDecoder;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.List;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @author xxx</span><br><span class="line"> * @createTime 2021/12/6 16:31</span><br><span class="line"> * @description 华为OBS工具类</span><br><span class="line"> */</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">public class HuaweiOBSUtil &#123;</span><br><span class="line"></span><br><span class="line">   @Autowired</span><br><span class="line">   private    OBSProperties obsProperties;</span><br><span class="line">    /**</span><br><span class="line">     * 上传File类型文件</span><br><span class="line">     *</span><br><span class="line">     * @param file</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public  String uploadFile(File file) &#123;</span><br><span class="line">        return getUploadFileUrl(file);</span><br><span class="line">    &#125;</span><br><span class="line">    public   File transferToFile(MultipartFile multipartFile) &#123;</span><br><span class="line">        //选择用缓冲区来实现这个转换即使用java 创建的临时文件 使用 MultipartFile.transferto()方法 。</span><br><span class="line">        File file = null;</span><br><span class="line">        try &#123;</span><br><span class="line">            String originalFilename = multipartFile.getOriginalFilename();</span><br><span class="line">            String[] filename = originalFilename.split(&quot;\\.&quot;);</span><br><span class="line">            file = File.createTempFile(filename[0], filename[1]);    //注意下面的 特别注意！！！</span><br><span class="line">            multipartFile.transferTo(file);</span><br><span class="line">            file.deleteOnExit();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return file;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 上传MultipartFile类型文件</span><br><span class="line">     *</span><br><span class="line">     * @param</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private  String getUploadFileUrl(File file) &#123;</span><br><span class="line">        //检查文件是否为null</span><br><span class="line">        if (file!=null) &#123;</span><br><span class="line">            String fileName = FileUtil.getName(file);</span><br><span class="line">            log.info(&quot;上传图片:&quot; + fileName);</span><br><span class="line">            /*log.info(&quot;ak:&quot; + ak);</span><br><span class="line">            log.info(&quot;sk:&quot; + sk);</span><br><span class="line">            log.info(&quot;endPoint:&quot; + endPoint);*/</span><br><span class="line">            ObsClient obsClient = new ObsClient(obsProperties.getAk(), obsProperties.getSk(), obsProperties.getEndPoint());</span><br><span class="line">            try &#123;</span><br><span class="line">                //判断桶是否存在,不存在则创建</span><br><span class="line">                if (!obsClient.headBucket(obsProperties.getBucketName())) &#123;</span><br><span class="line">                    obsClient.createBucket(obsProperties.getBucketName());</span><br><span class="line">                &#125;</span><br><span class="line">                PutObjectRequest request = new PutObjectRequest();</span><br><span class="line">                request.setBucketName(obsProperties.getBucketName());</span><br><span class="line">                request.setObjectKey(fileName);</span><br><span class="line">                request.setFile(file);</span><br><span class="line">                request.setAcl(AccessControlList.REST_CANNED_PUBLIC_READ);</span><br><span class="line">                PutObjectResult result = obsClient.putObject(request);</span><br><span class="line">                String url = result.getObjectUrl();</span><br><span class="line">                log.info(&quot;图片路径:&quot; + url);</span><br><span class="line">                return url;</span><br><span class="line">            &#125; catch (Exception e) &#123;</span><br><span class="line">                log.error(&quot;图片上传错误:&#123;&#125;&quot;, e);</span><br><span class="line">                throw new RuntimeException(&quot;图片上传失败&quot;);</span><br><span class="line">            &#125;/* finally &#123;</span><br><span class="line">                删除本地临时文件</span><br><span class="line">                HuaweiOBSUtil.deleteTempFile(file);</span><br><span class="line">            &#125;*/</span><br><span class="line">        &#125;</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 上传图片自定义code</span><br><span class="line">     *</span><br><span class="line">     * @param ak</span><br><span class="line">     * @param sk</span><br><span class="line">     * @param endPoint</span><br><span class="line">     * @param file</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public  String uploadFileByCode(String ak, String sk, String endPoint, String bucket, File file) &#123;</span><br><span class="line">        //String pathname = objectName;</span><br><span class="line">        try &#123;</span><br><span class="line">            String fileName = FileUtil.getName(file);</span><br><span class="line">            log.info(&quot;上传图片:&quot; + fileName);</span><br><span class="line">            ObsClient obsClient = new ObsClient(ak, sk, endPoint);</span><br><span class="line">            //判断桶是否存在,不存在则创建</span><br><span class="line">            if (!obsClient.headBucket(bucket)) &#123;</span><br><span class="line">                obsClient.createBucket(bucket);</span><br><span class="line">            &#125;</span><br><span class="line">            PutObjectRequest request = new PutObjectRequest();</span><br><span class="line">            request.setBucketName(bucket);</span><br><span class="line">            request.setObjectKey(fileName);</span><br><span class="line">            request.setFile(file);</span><br><span class="line">            request.setAcl(AccessControlList.REST_CANNED_PUBLIC_READ);</span><br><span class="line">            PutObjectResult result = obsClient.putObject(request);</span><br><span class="line">            String url = result.getObjectUrl();</span><br><span class="line">            log.info(&quot;文件名称:&quot;+fileName+&quot;图片路径:&quot; + url);</span><br><span class="line">            return url;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;图片上传错误:&#123;&#125;&quot;, e);</span><br><span class="line">        &#125; /*finally &#123;</span><br><span class="line">            HuaweiOBSUtil.deleteTempFile(file);</span><br><span class="line">        &#125;*/</span><br><span class="line">        return null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除本地临时文件</span><br><span class="line">     *</span><br><span class="line">     * @param file</span><br><span class="line">     */</span><br><span class="line">    public  void deleteTempFile(File file) &#123;</span><br><span class="line">        if (file != null) &#123;</span><br><span class="line">            File del = new File(file.toURI());</span><br><span class="line">            del.delete();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 批量n天删除之前的文件</span><br><span class="line">     *</span><br><span class="line">     * @param ak</span><br><span class="line">     * @param sk</span><br><span class="line">     * @param endPoint</span><br><span class="line">     * @param bucket</span><br><span class="line">     * @param requireHours</span><br><span class="line">     */</span><br><span class="line">    public  void batchDeleteForHoursago(String ak, String sk, String endPoint, String bucket, int requireHours) &#123;</span><br><span class="line">        ObsClient obsClient = new ObsClient(ak, sk, endPoint);</span><br><span class="line">        long currentTime = new Date().getTime();</span><br><span class="line">        try &#123;</span><br><span class="line">            ListObjectsRequest listRequest = new ListObjectsRequest(bucket);</span><br><span class="line">            listRequest.setMaxKeys(1000); // 每次至多返回1000个对象</span><br><span class="line">            ObjectListing listResult;</span><br><span class="line">            Date lastModified;</span><br><span class="line">            long hourMillisecond = 1000 * 3600 * 1;</span><br><span class="line">            // 分页查询</span><br><span class="line">            do &#123;</span><br><span class="line">                List&lt;KeyAndVersion&gt; toDelete = new ArrayList&lt;&gt;();</span><br><span class="line">                listResult = obsClient.listObjects(listRequest);</span><br><span class="line">                for (ObsObject obsObject : listResult.getObjects()) &#123;</span><br><span class="line">                    lastModified = obsObject.getMetadata().getLastModified();</span><br><span class="line">                    long diffs = (currentTime - lastModified.getTime()) / hourMillisecond; // 当前时间减去文件修改时间</span><br><span class="line">                    if (diffs &gt; requireHours</span><br><span class="line">                            &amp;&amp; (obsObject.getObjectKey().endsWith(&quot;.ts&quot;) || obsObject.getObjectKey().endsWith(&quot;.mp4&quot;))) &#123;</span><br><span class="line">                        log.info(&quot;文件距现在&#123;&#125;小时，对象更改日期：&#123;&#125;，文件对象：&#123;&#125;&quot;, diffs, lastModified, obsObject.getObjectKey());</span><br><span class="line">                        toDelete.add(new KeyAndVersion(obsObject.getObjectKey()));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                // 设置下次列举的起始位置</span><br><span class="line">                listRequest.setMarker(listResult.getNextMarker());</span><br><span class="line"></span><br><span class="line">                //批量删除文件</span><br><span class="line">                log.info(&quot;待删除的OBS对象数量：&#123;&#125;&quot;, toDelete.size());</span><br><span class="line">                if (!CollectionUtils.isEmpty(toDelete)) &#123;</span><br><span class="line">                    DeleteObjectsRequest deleteRequest = new DeleteObjectsRequest(bucket);</span><br><span class="line">                    deleteRequest.setQuiet(true); // 设置为quiet模式,只返回删除失败的对象</span><br><span class="line">                    deleteRequest.setKeyAndVersions(toDelete.toArray(new KeyAndVersion[toDelete.size()]));</span><br><span class="line">                    DeleteObjectsResult deleteResult = obsClient.deleteObjects(deleteRequest);</span><br><span class="line">                    if (!CollectionUtils.isEmpty(deleteResult.getErrorResults())) &#123;</span><br><span class="line">                        log.error(&quot;删除失败的OBS对象数量：&#123;&#125;&quot;, deleteResult.getErrorResults().size());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; while (listResult.isTruncated());</span><br><span class="line"></span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            log.error(&quot;华为OBS批量删除异常&quot;, e);</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            try &#123;</span><br><span class="line">                obsClient.close();</span><br><span class="line">            &#125; catch (IOException e) &#123;</span><br><span class="line">                log.error(&quot;华为OBS关闭客户端失败&quot;, e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除单个对象</span><br><span class="line">     *</span><br><span class="line">     * @param ak</span><br><span class="line">     * @param sk</span><br><span class="line">     * @param endPoint</span><br><span class="line">     * @param bucket</span><br><span class="line">     * @param objectKey</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public  boolean deleteFile(String ak, String sk, String endPoint, String bucket, String objectKey) &#123;</span><br><span class="line">        ObsClient obsClient = new ObsClient(ak, sk, endPoint);</span><br><span class="line">        DeleteObjectResult deleteObjectResult = obsClient.deleteObject(bucket, objectKey);</span><br><span class="line">        boolean deleteMarker = deleteObjectResult.isDeleteMarker();</span><br><span class="line">        try &#123;</span><br><span class="line">            obsClient.close();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;华为OBS关闭客户端失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return deleteMarker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 查询桶内已使用空间大小</span><br><span class="line">     *</span><br><span class="line">     * @param ak</span><br><span class="line">     * @param sk</span><br><span class="line">     * @param endPoint</span><br><span class="line">     * @param bucket</span><br><span class="line">     * @return 单位字节</span><br><span class="line">     */</span><br><span class="line">    public  long getBucketUseSize(String ak, String sk, String endPoint, String bucket) &#123;</span><br><span class="line">        ObsClient obsClient = new ObsClient(ak, sk, endPoint);</span><br><span class="line">        BucketStorageInfo storageInfo = obsClient.getBucketStorageInfo(bucket);</span><br><span class="line">        log.info(&quot;&#123;&#125; 桶内对象数：&#123;&#125;  已使用的空间大小B:&#123;&#125; GB:&#123;&#125;&quot;, bucket, storageInfo.getObjectNumber(), storageInfo.getSize(), storageInfo.getSize() / 1024 / 1024 / 1024);</span><br><span class="line">        try &#123;</span><br><span class="line">            obsClient.close();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            log.error(&quot;华为OBS关闭客户端失败&quot;, e);</span><br><span class="line">        &#125;</span><br><span class="line">        return storageInfo.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public  String readFileContent(String fileName) &#123;</span><br><span class="line">        File file = new File(fileName);</span><br><span class="line">        BufferedReader reader = null;</span><br><span class="line">        StringBuffer sbf = new StringBuffer();</span><br><span class="line">        try &#123;</span><br><span class="line">            reader = new BufferedReader(new FileReader(file));</span><br><span class="line">            String tempStr;</span><br><span class="line">            while ((tempStr = reader.readLine()) != null) &#123;</span><br><span class="line">                sbf.append(tempStr);</span><br><span class="line">            &#125;</span><br><span class="line">            reader.close();</span><br><span class="line">            return sbf.toString();</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            if (reader != null) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    reader.close();</span><br><span class="line">                &#125; catch (IOException e1) &#123;</span><br><span class="line">                    e1.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return sbf.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据下载地址url获取文件名称</span><br><span class="line">     * @param url</span><br><span class="line">     * @throws IOException</span><br><span class="line">     */</span><br><span class="line">    public  String getFilenameByUrl(String url)&#123;</span><br><span class="line">        String fileName= null;</span><br><span class="line">        try &#123;</span><br><span class="line">            //url编码处理，中文名称会变成百分号编码</span><br><span class="line">            String decode = URLDecoder.decode(url, &quot;utf-8&quot;);</span><br><span class="line">            fileName = decode.substring(decode.lastIndexOf(&quot;/&quot;)+1);</span><br><span class="line">            log.info(&quot;fileName :&quot; + fileName);</span><br><span class="line">        &#125; catch (UnsupportedEncodingException e) &#123;</span><br><span class="line">            log.error(&quot;getFilenameByUrl() called with exception =&gt; 【url = &#123;&#125;】&quot;, url,e);</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        return fileName;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>映射注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">package com.star.qiaosi.config;</span><br><span class="line"></span><br><span class="line">import lombok.Data;</span><br><span class="line">import org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line">import org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line">@Data</span><br><span class="line">@Component</span><br><span class="line">@ConfigurationProperties(prefix = &quot;obs&quot;)</span><br><span class="line">public class OBSProperties &#123;</span><br><span class="line">    private  String endPoint;</span><br><span class="line">    private  String ak;</span><br><span class="line">    private  String sk;</span><br><span class="line">    private  String bucketName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Mysql字典表"><a href="#Mysql字典表" class="headerlink" title="Mysql字典表"></a>Mysql字典表</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `sys_dict_item` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键&#x27;,</span><br><span class="line">  `dict_type_code` varchar(255) NOT NULL COMMENT &#x27;字典类型编码&#x27;,</span><br><span class="line">  `dict_code` varchar(255) NOT NULL COMMENT &#x27;数据编码&#x27;,</span><br><span class="line">  `dict_value` varchar(255) DEFAULT NULL COMMENT &#x27;值&#x27;,</span><br><span class="line">  `dict_name` varchar(255) NOT NULL COMMENT &#x27;字典名称&#x27;,</span><br><span class="line">  `dict_desc` varchar(255) DEFAULT NULL COMMENT &#x27;描述&#x27;,</span><br><span class="line">  `sort` int(5) DEFAULT NULL COMMENT &#x27;排序&#x27;,</span><br><span class="line">  `status` enum(&#x27;0&#x27;,&#x27;1&#x27;) NOT NULL DEFAULT &#x27;1&#x27; COMMENT &#x27;0 禁用；1 启用&#x27;,</span><br><span class="line">  `create_by` varchar(50) DEFAULT NULL COMMENT &#x27;创建人&#x27;,</span><br><span class="line">  `create_by_user_id` int(11) DEFAULT NULL COMMENT &#x27;创建人id&#x27;,</span><br><span class="line">  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_by` varchar(50) DEFAULT NULL COMMENT &#x27;修改人&#x27;,</span><br><span class="line">  `update_by_user_id` int(11) DEFAULT NULL COMMENT &#x27;修改人id&#x27;,</span><br><span class="line">  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `idx_dict_code` (`dict_code`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;系统字典条目表&#x27;;</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE `sys_dict_type` (</span><br><span class="line">  `id` int(11) NOT NULL AUTO_INCREMENT COMMENT &#x27;主键&#x27;,</span><br><span class="line">  `dict_type_code` varchar(255) NOT NULL COMMENT &#x27;数据类型编码&#x27;,</span><br><span class="line">  `dict_type_name` varchar(255) NOT NULL COMMENT &#x27;数据类型名称&#x27;,</span><br><span class="line">  `dict_desc` varchar(255) DEFAULT NULL COMMENT &#x27;描述&#x27;,</span><br><span class="line">  `sort` int(5) DEFAULT &#x27;1&#x27; COMMENT &#x27;排序&#x27;,</span><br><span class="line">  `create_by` varchar(50) DEFAULT NULL COMMENT &#x27;创建人&#x27;,</span><br><span class="line">  `create_by_user_id` int(11) DEFAULT NULL COMMENT &#x27;创建人id&#x27;,</span><br><span class="line">  `create_time` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT &#x27;创建时间&#x27;,</span><br><span class="line">  `update_by` varchar(50) DEFAULT NULL COMMENT &#x27;修改人&#x27;,</span><br><span class="line">  `update_by_user_id` int(11) DEFAULT NULL COMMENT &#x27;修改人id&#x27;,</span><br><span class="line">  `update_time` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT &#x27;修改时间&#x27;,</span><br><span class="line">  PRIMARY KEY (`id`),</span><br><span class="line">  UNIQUE KEY `idx_dict_type_code` (`dict_type_code`)</span><br><span class="line">) ENGINE=InnoDB DEFAULT CHARSET=utf8 COMMENT=&#x27;系统字典类型表&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="Springboot整合secruity"><a href="#Springboot整合secruity" class="headerlink" title="Springboot整合secruity"></a>Springboot整合secruity</h3><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/hyk521/article/details/107215268">(4条消息) SpringBoot结合SpringSecurity动态权限认证设置_幸运小男神的博客-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://gitee.com/vipboo/security-spring-boot/blob/master/src/main/java/com/vipbbo/security/springboot/controller/LoginController.java">src&#x2F;main&#x2F;java&#x2F;com&#x2F;vipbbo&#x2F;security&#x2F;springboot&#x2F;controller&#x2F;LoginController.java · &#x2F;w&#x2F;security-spring-boot - 码云 - 开源中国 (gitee.com)</a></p>
<h3 id="索引下推-覆盖索引"><a href="#索引下推-覆盖索引" class="headerlink" title="索引下推 覆盖索引"></a>索引下推 覆盖索引</h3><p>索引下推（index condition pushdown ）简称ICP，在Mysql5.6的版本上推出，用于优化查询。</p>
<p>在不使用ICP的情况下，在使用非主键索引（又叫普通索引或者二级索引）进行查询时，存储引擎通过索引检索到数据，然后返回给MySQL服务器，服务器然后判断数据是否符合条件 。</p>
<p>在使用ICP的情况下，如果存在某些被索引的列的判断条件时，MySQL服务器将这一部分判断条件传递给存储引擎，然后由存储引擎通过判断索引是否符合MySQL服务器传递的条件，只有当索引符合条件时才会将数据检索出来返回给MySQL服务器 </p>
<h3 id="代码生成器"><a href="#代码生成器" class="headerlink" title="代码生成器"></a>代码生成器</h3><p>引入pom</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;mysql&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       &lt;!-- lombok --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.projectlombok&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;lombok&lt;/artifactId&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       &lt;!-- mybatis-plus --&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;mybatis-plus-boot-starter&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;3.0.5&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       &lt;!-- 代码自动生成器依赖--&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;com.baomidou&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;mybatis-plus-generator&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;3.0.5&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.apache.velocity&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;velocity-engine-core&lt;/artifactId&gt;</span><br><span class="line">           &lt;version&gt;2.2&lt;/version&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line"></span><br><span class="line">       &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">       &lt;dependency&gt;</span><br><span class="line">           &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">           &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">           &lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">       &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>编写yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">server:</span><br><span class="line">  port: 9099</span><br><span class="line">spring:</span><br><span class="line">  datasource:</span><br><span class="line">    type: com.zaxxer.hikari.HikariDataSource</span><br><span class="line">    driver-class-name: com.mysql.cj.jdbc.Driver</span><br><span class="line">    # MySql</span><br><span class="line">    url: jdbc:mysql://localhost:3306/xxx?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;nullCatalogMeansCurrent=true&amp;allowPublicKeyRetrieval=true</span><br><span class="line">    #url: jdbc:mysql://127.0.0.1:3306/xxx?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;nullCatalogMeansCurrent=true&amp;allowPublicKeyRetrieval=true</span><br><span class="line">    username: xxxx</span><br><span class="line">    password: xxxx</span><br><span class="line">mybatis-plus:</span><br><span class="line">  global-config:</span><br><span class="line">    db-config:</span><br><span class="line">      logic-delete-value: 1</span><br><span class="line">      logic-not-delete-value: 0</span><br><span class="line">  configuration:</span><br><span class="line">    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">package com.example.test.generator;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.baomidou.mybatisplus.annotation.FieldFill;</span><br><span class="line">import com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line">import com.baomidou.mybatisplus.core.exceptions.MybatisPlusException;</span><br><span class="line">import com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.DataSourceConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.GlobalConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.PackageConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.StrategyConfig;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.po.TableFill;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line">import com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line">import org.apache.commons.lang3.StringUtils;</span><br><span class="line"></span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.Scanner;</span><br><span class="line"></span><br><span class="line">public class CodeGenerator &#123;</span><br><span class="line"></span><br><span class="line">    public static String scanner(String tip) &#123;</span><br><span class="line">        Scanner scanner = new Scanner(System.in);</span><br><span class="line">        StringBuilder help = new StringBuilder();</span><br><span class="line">        help.append(&quot;请输入&quot; + tip + &quot;：&quot;);</span><br><span class="line">        System.out.println(help.toString());</span><br><span class="line">        if (scanner.hasNext()) &#123;</span><br><span class="line">            String ipt = scanner.next();</span><br><span class="line">            if (StringUtils.isNotBlank(ipt)) &#123;</span><br><span class="line">                return ipt;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        throw new MybatisPlusException(&quot;请输入正确的&quot; + tip + &quot;！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        // 代码生成器</span><br><span class="line">        AutoGenerator mpg = new AutoGenerator();</span><br><span class="line"></span><br><span class="line">        // 全局配置</span><br><span class="line">        GlobalConfig gc = new GlobalConfig();</span><br><span class="line">        String projectPath = System.getProperty(&quot;user.dir&quot;);</span><br><span class="line">        gc.setOutputDir(projectPath + &quot;/src/main/java&quot;);//设置代码生成路径</span><br><span class="line">        gc.setFileOverride(true);//是否覆盖以前文件</span><br><span class="line">        gc.setOpen(false);//是否打开生成目录</span><br><span class="line">        gc.setAuthor(&quot;Cheng&quot;);//设置项目作者名称</span><br><span class="line">        gc.setIdType(IdType.AUTO);//设置主键策略</span><br><span class="line">        gc.setBaseResultMap(true);//生成基本ResultMap</span><br><span class="line">        gc.setBaseColumnList(true);//生成基本ColumnList</span><br><span class="line">        gc.setServiceName(&quot;%sService&quot;);//去掉服务默认前缀</span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);//设置时间类型</span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        // 数据源配置</span><br><span class="line">        DataSourceConfig dsc = new DataSourceConfig();</span><br><span class="line">        dsc.setUrl(&quot;jdbc:mysql://localhost:3306/xxx?useSSL=false&amp;useUnicode=true&amp;characterEncoding=utf-8&amp;zeroDateTimeBehavior=convertToNull&amp;transformedBitIsBoolean=true&amp;nullCatalogMeansCurrent=true&amp;allowPublicKeyRetrieval=true&quot;);</span><br><span class="line">        dsc.setDriverName(&quot;com.mysql.cj.jdbc.Driver&quot;);</span><br><span class="line">        dsc.setUsername(&quot;xxx&quot;);</span><br><span class="line">        dsc.setPassword(&quot;xxx&quot;);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        // 包配置</span><br><span class="line">        PackageConfig pc = new PackageConfig();</span><br><span class="line">        pc.setParent(&quot;com.example.test&quot;);</span><br><span class="line">        pc.setMapper(&quot;mapper&quot;);</span><br><span class="line">        pc.setXml(&quot;mapper.xml&quot;);</span><br><span class="line">        pc.setEntity(&quot;entity&quot;);</span><br><span class="line">        pc.setService(&quot;service&quot;);</span><br><span class="line">        pc.setServiceImpl(&quot;service.impl&quot;);</span><br><span class="line">        pc.setController(&quot;controller&quot;);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        // 策略配置</span><br><span class="line">        StrategyConfig sc = new StrategyConfig();</span><br><span class="line">        sc.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        sc.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        sc.setEntityLombokModel(true);//自动lombok</span><br><span class="line">        sc.setRestControllerStyle(true);</span><br><span class="line">        sc.setControllerMappingHyphenStyle(true);</span><br><span class="line"></span><br><span class="line">        sc.setLogicDeleteFieldName(&quot;deleted&quot;);//设置逻辑删除</span><br><span class="line"></span><br><span class="line">        //设置自动填充配置</span><br><span class="line">        TableFill gmt_create = new TableFill(&quot;create_time&quot;, FieldFill.INSERT);</span><br><span class="line">        TableFill gmt_modified = new TableFill(&quot;update_time&quot;, FieldFill.INSERT_UPDATE);</span><br><span class="line">        ArrayList&lt;TableFill&gt; tableFills = new ArrayList&lt;&gt;();</span><br><span class="line">        tableFills.add(gmt_create);</span><br><span class="line">        tableFills.add(gmt_modified);</span><br><span class="line">        sc.setTableFillList(tableFills);</span><br><span class="line"></span><br><span class="line">        //乐观锁</span><br><span class="line">        sc.setVersionFieldName(&quot;version&quot;);</span><br><span class="line">        sc.setRestControllerStyle(true);//驼峰命名</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //  sc.setTablePrefix(&quot;tbl_&quot;); 设置表名前缀</span><br><span class="line">        sc.setInclude(scanner(&quot;表名，多个英文逗号分割&quot;).split(&quot;,&quot;));</span><br><span class="line">        mpg.setStrategy(sc);</span><br><span class="line"></span><br><span class="line">        // 生成代码</span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="springboot整合flyway"><a href="#springboot整合flyway" class="headerlink" title="springboot整合flyway"></a>springboot整合flyway</h3><p>导入pom依赖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;flyway-core&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.2.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>修改yml文件 当作参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">flyway配置详解</span><br><span class="line">flyway.baseline-description对执行迁移时基准版本的描述.</span><br><span class="line">flyway.baseline-on-migrate当迁移时发现目标schema非空，而且带有没有元数据的表时，是否自动执</span><br><span class="line">行基准迁移，默认false.</span><br><span class="line">flyway.baseline-version开始执行基准迁移时对现有的schema的版本打标签，默认值为1.</span><br><span class="line">flyway.check-location检查迁移脚本的位置是否存在，默认false.</span><br><span class="line">flyway.clean-on-validation-error当发现校验错误时是否自动调用clean，默认false.</span><br><span class="line">flyway.enabled是否开启flywary，默认true.</span><br><span class="line">flyway.encoding设置迁移时的编码，默认UTF-8.</span><br><span class="line">flyway.ignore-failed-future-migration当读取元数据表时是否忽略错误的迁移，默认false.</span><br><span class="line">flyway.init-sqls当初始化好连接时要执行的SQL.</span><br><span class="line">flyway.locations迁移脚本的位置，默认db/migration.</span><br><span class="line">flyway.out-of-order是否允许无序的迁移，默认false.</span><br><span class="line">flyway.password目标数据库的密码.</span><br><span class="line">flyway.placeholder-prefix设置每个placeholder的前缀，默认$&#123;.</span><br><span class="line">flyway.placeholder-replacementplaceholders是否要被替换，默认true.</span><br><span class="line">flyway.placeholder-suffix设置每个placeholder的后缀，默认&#125;.</span><br><span class="line">flyway.placeholders.[placeholder name]设置placeholder的value</span><br><span class="line">flyway.schemas设定需要flywary迁移的schema，大小写敏感，默认为连接默认的schema.</span><br><span class="line">flyway.sql-migration-prefix迁移文件的前缀，默认为V.</span><br><span class="line">flyway.sql-migration-separator迁移脚本的文件名分隔符，默认__</span><br><span class="line">flyway.sql-migration-suffix迁移脚本的后缀，默认为.sql</span><br><span class="line">flyway.tableflyway使用的元数据表名，默认为schema_version</span><br><span class="line">flyway.target迁移时使用的目标版本，默认为latest version</span><br><span class="line">flyway.url迁移时使用的JDBC URL，如果没有指定的话，将使用配置的主数据源</span><br><span class="line">flyway.user迁移数据库的用户名</span><br><span class="line">flyway.validate-on-migrate迁移时是否校验，默认为true.</span><br></pre></td></tr></table></figure>

<p>参考yml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  flyway:</span><br><span class="line">    # 是否启用flyway</span><br><span class="line">    enabled: true</span><br><span class="line">    # 编码格式，默认UTF-8</span><br><span class="line">    encoding: UTF-8</span><br><span class="line">    # 迁移sql脚本文件存放路径，默认db/migration</span><br><span class="line">    locations: classpath:db/migration</span><br><span class="line">    # 迁移sql脚本文件名称的前缀，默认V</span><br><span class="line">    sql-migration-prefix: V</span><br><span class="line">    # 迁移sql脚本文件名称的分隔符，默认2个下划线__</span><br><span class="line">    sql-migration-separator: __</span><br><span class="line">    # 迁移sql脚本文件名称的后缀</span><br><span class="line">    sql-migration-suffixes: .sql</span><br><span class="line">    # 迁移时是否进行校验，默认true</span><br><span class="line">    validate-on-migrate: true</span><br><span class="line">    # 当迁移发现数据库非空且存在没有元数据的表时，自动执行基准迁移，新建schema_version表</span><br><span class="line">    baseline-on-migrate: true</span><br></pre></td></tr></table></figure>

<p>在resource下新建包 报名db.migration</p>
<p>sql文件名称</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">V1.0__create_user_table.sql //V+版本号(版本号的数字间以”.“或”_“分隔开)+双下划线(用来分隔版本号和描述)+文件描述+后缀名</span><br></pre></td></tr></table></figure>

<p>pom引入管理工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;</span><br><span class="line">            &lt;groupId&gt;org.flywaydb&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;flyway-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;5.2.4&lt;/version&gt;</span><br><span class="line">            &lt;configuration&gt;</span><br><span class="line">                &lt;url&gt;jdbc:mysql://localhost:3306/flyway-demo?characterEncoding=utf-8&amp;amp;useSSL=false&amp;amp;serverTimezone=Asia/Shanghai</span><br><span class="line">                &lt;/url&gt;</span><br><span class="line">                &lt;user&gt;root&lt;/user&gt;</span><br><span class="line">                &lt;password&gt;root&lt;/password&gt;</span><br><span class="line">                &lt;driver&gt;com.mysql.cj.jdbc.Driver&lt;/driver&gt;</span><br><span class="line">            &lt;/configuration&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/09/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="Dragon，王嘉浩">
      <meta itemprop="description" content="来去都是自由风">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="石圪节公社球头制造者">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/09/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-09-09 18:38:44" itemprop="dateCreated datePublished" datetime="2023-09-09T18:38:44+08:00">2023-09-09</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">&quot;My New Post&quot;</span></span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Dragon，王嘉浩"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">Dragon，王嘉浩</p>
  <div class="site-description" itemprop="description">来去都是自由风</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">2</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Dragon，王嘉浩</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
